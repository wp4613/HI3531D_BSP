#!/bin/sh

ipaddr=192.168.0.11
bootp=
gateway=192.168.0.1
netmask=255.255.255.0
hostname=
netdev=eth0
autoconf=
netmode=0   # du li mo shi

if [ "x$ipaddr" == "x"  ];then # >>>>>
for ipinfo in `cat /proc/cmdline`
do
	case "$ipinfo" in
	ip=*)
		for var in  ipaddr bootp gateway netmask hostname netdev autoconf
		do
			eval read $var
		done << EOF
		`echo "$ipinfo" | sed "s/:/\n/g" | sed "s/^[ 	]*$/-/g"`
EOF
		ipaddr=`echo "$ipaddr" | cut -d = -f 2`
		[ x$ipaddr == x ] && ipaddr=x
		;;
	esac
done
fi # <<<<<


echo $ipaddr

if [ "x$ipaddr" == "x" -o "x$ipaddr" == "xx" ];then
    ipaddr=192.168.0.11
    gateway=192.168.0.1
    netmask=255.255.255.0
    netdev=eth0
fi
[ -z "$ipaddr" ] && exit 0

echo "      IP: $ipaddr"
echo "   BOOTP: $bootp"
echo " GATEWAY: $gateway"
echo " NETMASK: $netmask"
echo "HOSTNAME: $hostname"
echo "  NETDEV: $netdev"
echo "AUTOCONF: $autoconf"


if [ x$ipaddr == x- ] ; then
	# use DHCP
	:
else
	cmd="ifconfig $netdev $ipaddr"
	[ x$netmask != x- ] && cmd="$cmd netmask $netmask"
	eval $cmd
	[ x$gateway != x- ] && route add default gw $gateway

    ipaddr1=$(echo $ipaddr | cut -d "." -f1)
    ipaddr2=$(echo $ipaddr | cut -d "." -f2)
    ipaddr3=$(echo $ipaddr | cut -d "." -f3)
    ipaddr4=$(echo $ipaddr | cut -d "." -f4)
    netmask1=$(echo $netmask | cut -d "." -f1)
    netmask2=$(echo $netmask | cut -d "." -f2)
    netmask3=$(echo $netmask | cut -d "." -f3)
    netmask4=$(echo $netmask | cut -d "." -f4)
    netaddr=$(($ipaddr1&$netmask1)).$(($ipaddr2&$netmask2)).$(($ipaddr3&$netmask3)).$(($ipaddr4&$netmask4))
    echo "route add net $netaddr netmask $netmask $netdev"
	[ x$gateway != x- ] && route add -net $netaddr netmask $netmask $netdev
fi

ifconfig lo 127.0.0.1

